<!doctype html>
<html lang=en id=faq>

<title>Following -current and using snapshots</title>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/current.html">

<h2 id=OpenBSD>
<a href="../index.html">
<i>Open</i><b>BSD</b></a>
Following -current and using snapshots
<small>
<a href="index.html">[FAQ Index]</a>
</small>
</h2>
<hr>

<p>
Active OpenBSD development is known as the
<a href="faq5.html#Flavors">-current</a> branch.
These sources are frequently compiled into releases known as <i>snapshots</i>.

<p>
Aggressive changes are sometimes pushed in this branch, and complications can
arise when building the latest code or upgrading from a previous point in time.
Some of the steps for getting over these hurdles are explained on this page.
Make sure you've read and understand how to
<a href="faq5.html">build the system from source</a> before using -current
and the instructions below.

<p>
In general, it's far easier to use snapshots, as developers will have gone
through much of the trouble for you already.

<p>
You should <b>always</b> use a snapshot as the starting point for running
-current.
This process typically consists of running
<a href="https://man.openbsd.org/sysupgrade">sysupgrade(8)</a> with the
<code>-s</code> flag.
Alternatively, download (and verify) the appropriate
<a href="faq4.html#bsd.rd">bsd.rd</a> file from the <code>/snapshots/</code>
directory of your preferred <a href="../ftp.html">mirror</a>, boot from it,
and choose <code>(U)pgrade</code> at the prompt.
Any installed packages should then be
<a href="faq15.html#PkgUpdate">upgraded</a> after booting into the new system.

<p>
Upgrading to -current by compiling your own source code is discouraged
for everyone except for experts, as difficult build-time crossing-points
can occur often, and no assistance will be provided.  In case of failure,
use a snapshot to recover.

<p>
Most of these changes will have to be performed as root.


<h3 id="r20220423">2022/04/23 - switchd(8) removed</h3>
switchd(8) has been removed from the base system.
To cleanup the no longer needed user, group and files execute the following
commands:
<blockquote><pre>
# <b>userdel _switchd</b>
# <b>groupdel _switchd</b>
# <b>rm /etc/rc.d/switchd /usr/sbin/switchctl /usr/sbin/switchd \
  /usr/share/man/man4/switch.4 /usr/share/man/man5/switchd.conf.5 \
  /usr/share/man/man8/switchctl.8 /usr/share/man/man8/switchd.8</b>
</pre></blockquote>


<h3 id="r20220514">2022/05/14 - [packages] OpenLDAP update</h3>
The OpenLDAP packages have been updated to the 2.6 branch and have
changes which will affect many users of the server ("slapd").
<b>Backup before updating</b>, and be prepared for a more complicated
upgrade than usual.
Some pointers are given here, but as is normal with packages,
also consult the upstream documentation regarding upgrades.<p>

<ul>
<li><b>OpenLDAP no longer supports the BDB/HDB legacy database formats
based on Berkeley DB.</b></li>
If you are using BDB/HDB, you will need to prepare in advance so
that you can move to MDB.<p>

Before updating, stop slapd and use <tt>slapcat</tt> to dump your database(s)
to ldif files.
(Saving ldif files is recommended as part of your regular maintenance anyway,
but particularly important at this time).<p>

Adjust the backend database in your configuration to use mdb instead of
bdb/hdb.
If you are using the old-style /etc/openldap/slapd.conf config file this
is relatively straightforward.
If you are using upstream's recommended on-line configuration ("cn=config")
this is normally edited "in-band" via LDAP, but you might find
it difficult to make this type of change in the usual way.
Instead you can export to ldif with <tt>slapcat -n 0</tt>, edit the
exported file, then reload with <tt>slapadd -n 0</tt>.
Do not edit the ldif files in /etc/openldap/slapd.d directly.
<p>

Regarding the actual changes you need to make: in the simplest case you
just need to change "bdb" to "mdb".
slapd-bdb(5) has various tuning options which are not used by
slapd-mdb(5) (for example, cachesize) - these will need to be removed.
For more information, consult the upstream documentation.<p>

After restarting with the updated configuration, you will need to
reload your database from the ldif file using slapadd (or if you are
updating a read-only replica you could let syncrepl pick it up).

<li><b>The openldap-server package has changed to a modular build.</b></li>

The most important backend and overlay (mdb and syncprov) are still
compiled-in as before, but if you use the less common ones (including
backends like back_perl) you will need to adjust your configuration
to load them.
If you use online configuration, see "olcModuleLoad".
If you use slapd.conf, see "moduleload".
</ul>


<h3 id="r20220521">2022/05/21 - deprecation of ${rcexec} in rc.d scripts</h3>
The ${rcexec} variable used to start daemons with rc.d(8) has been replaced with
a more complete rc_exec() function.
Handcrafted rc.d(8) scripts must be modified to use this new function:
<blockquote><pre>
# <b>sed -i 's/\${rcexec}/rc_exec/' /etc/rc.d/myscript</b>
</pre></blockquote>
Compatibility will be retained until next release.


<h3 id="r20220528">2022/05/28 - [packages] Vim colour scheme changes</h3>
Vim includes <a href="https://github.com/vim/colorschemes">new colour
schemes</a>.
They aim to be more consistent in different environments (e.g. between
text and gui versions), but in some cases result in a significant change,
especially for the text version.<p>

If you find the changes unwelcome, the OpenBSD package includes a copy of
the old colour schemes under the <tt>legacy</tt> subdirectory to make it
easier to revert if desired.
You can use the subdirectory directly in <tt>colorscheme</tt> in your
configuration, but as these are not included as standard in upstream Vim,
if you share config files between various machines you may like to copy
the relevant files from /usr/local/share/vim/vim82/colors/legacy to
~/.vim/colors which take priority.


<h3 id="r20220603">2022/06/03 - [packages] Fcitx update requires manual reconfigure</h3>

Fcitx splits some input methods into different packages and requires manual
reconfiguration after upgrade.

Notably:
<ul>
<li><b>Fcitx no longer bundles PinYin, you will need to install
fcitx-chinese-addons to use PinYin.</b></li>

<li><b>Methods previously provided by the fcitx-table package are split into two
packages:</b></li>

<p>For CangJie / ShuangPin / WuBi / ErBi / ZiRanMa, install
fcitx-chinese-addons.

<p>For ZhengMa / Boshiamy / Quick and other WuBi / CangJie tables,
install fcitx-table-extra.

<li>If you are starting fcitx from <tt>.xsession</tt>, update it with the following:</li>

<blockquote><pre>
<b>export XMODIFIERS=@im=fcitx</b>
<b>export GTK_IM_MODULE=fcitx</b>
<b>export QT_IM_MODULE=fcitx</b>
<b>/usr/local/bin/fcitx5 &</b>
</pre></blockquote>

<li><b>You might need to re-run <tt>fcitx5-configtool</tt>
to reconfigure your input method</b></li>

To setup an input engine, run <tt>fcitx5-configtool</tt> after starting fcitx5,
then select and add your preferred input method from the Avaliable
Input Method panel. You might need to uncheck 'Only Show Current
Language' to find your preferred input method.

After restarting with the updated configuration, fcitx should be usable, refers
to <tt>/usr/local/share/doc/pkg-readmes/fcitx</tt> in case something doesn't
work or you need to troubleshoot.
</ul>


<!--
     Two blank lines before new sections.
     New sentences start on new lines.
     Try to make lines shorter than 80 characters.
-->

<hr id="end">
<small>$OpenBSD: current.html,v 1.1089 2022/06/04 12:48:17 op Exp $</small>
